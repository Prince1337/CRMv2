version: "3.9"
services:

      mysql:
        container_name: mysql
        build:
          context: ./mysql
          dockerfile: Dockerfile
        image: mysql:latest
        ports:
          - "3308:3306"
        environment:
          MYSQL_ROOT_PASSWORD: M354224331315m
          MYSQL_USER: crm
          MYSQL_PASSWORD: crm
          MYSQL_DATABASE: crmdatabase
        volumes:
          - ./mysql-data:/var/lib/mysql
        command: mysqld --skip-name-resolve=0
        networks:
          - crm-network
        restart: always
        
      backend:
        container_name: Customer-Relationship-Management-0.0.2-SNAPSHOT
        build:
          context: ./backend
          dockerfile: Dockerfile
        ports:
          - "8443:8443"
        depends_on:
          - mysql
        networks:
          - crm-network
        environment:
          - MYSQL_HOST=mysql
          - MYSQL_USERNAME=crm
          - MYSQL_PASSWORD=crm
          - MYSQL_DATABASE=crmdatabase
          - MYSQL_PORT=3306
        command: ["java", "-jar", "/app/backend/build/libs/Customer-Relationship-Management-0.0.2-SNAPSHOT.jar"]
        volumes:
          - .:/app
          - gradle-cache:/home/gradle/.gradle
          
      frontend:
        container_name: frontend
        build:
          context: ./frontendnew/crm
          dockerfile: Dockerfile
        ports:
          - "4200:4200"
        volumes:
            - ./frontendnew/crm:/frontendnew
        environment:
            - NODE_ENV=dev
        networks:
          - crm-network
        command: ng serve --host 0.0.0.0


networks:
  crm-network:
    driver: bridge
volumes:
  gradle-cache: